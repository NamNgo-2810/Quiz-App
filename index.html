<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Quick Quiz</title>
    <link rel="stylesheet" href="app.css" />
  </head>
  <body>
    <div class="author-credit">
      Made by namnv7@mbbank.com.vn
    </div>
    <div class="container">
      <div id="home" class="flex-center flex-column">
        <h1>Quiz App</h1>

        <form>
          <select id="topicSelect" onchange="updateQuestionLimit()">
            <option value="">Select a topic...</option>
            <!-- Topics will be dynamically loaded here -->
          </select>

          <input
          type="number"
          id="questionCount"
          placeholder="Enter number of questions (e.g., 10)"
          min="1"
          disabled
          />
        </form>


        <button class="btn" onclick="startQuiz()" disabled id="startBtn">Start Quiz</button>
        <a class="btn" href="/highscores.html">High Scores</a>
      </div>
    </div>

    <script>
      // Dynamic topic configuration - will be loaded from manifest
      let topicConfig = {};

      // Function to load topics from manifest
      async function loadTopics() {
        try {
          const response = await fetch('./questions-manifest.json');
          if (!response.ok) {
            throw new Error('Failed to load questions manifest');
          }
          const manifest = await response.json();

          // Convert manifest to topicConfig format and populate dropdown
          const topicSelect = document.getElementById("topicSelect");

          manifest.topics.forEach(topic => {
            topicConfig[topic.filename] = {
              name: topic.displayName,
              maxQuestions: topic.questionCount,
              path: topic.path
            };

            // Add option to dropdown
            const option = document.createElement("option");
            option.value = topic.filename;
            option.textContent = `${topic.displayName} (${topic.questionCount} questions)`;
            topicSelect.appendChild(option);
          });

        } catch (error) {
          console.error('Error loading topics:', error);
          alert('Failed to load quiz topics. Please refresh the page.');
        }
      }

      // Load topics when page loads
      document.addEventListener('DOMContentLoaded', loadTopics);

      function updateQuestionLimit() {
        const topicSelect = document.getElementById("topicSelect");
        const questionCountInput = document.getElementById("questionCount");
        const startBtn = document.getElementById("startBtn");

        const selectedTopic = topicSelect.value;

        if (selectedTopic) {
          const maxQuestions = topicConfig[selectedTopic].maxQuestions;
          questionCountInput.disabled = false;
          questionCountInput.max = maxQuestions;
          questionCountInput.placeholder = `Enter number of questions you want to do`;
          startBtn.disabled = false;
        } else {
          questionCountInput.disabled = true;
          questionCountInput.value = "";
          questionCountInput.placeholder = "Select a topic first";
          startBtn.disabled = true;
        }
      }

      function startQuiz() {
        const topicSelect = document.getElementById("topicSelect");
        const selectedTopic = topicSelect.value;
        const count = parseInt(document.getElementById("questionCount").value);

        if (!selectedTopic) {
          alert("Please select a topic first.");
          return;
        }

        const maxQuestions = topicConfig[selectedTopic].maxQuestions;

        if (!count || count <= 0 || count > maxQuestions) {
          alert(`Please enter a valid number between 1 and ${maxQuestions}.`);
          return;
        }

        localStorage.setItem("questionCount", count);
        localStorage.setItem("selectedTopic", selectedTopic);
        window.location.href = "/game.html";
      }
    </script>
  </body>
</html>
